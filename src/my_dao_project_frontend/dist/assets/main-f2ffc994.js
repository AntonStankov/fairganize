import{H as d,P as m}from"./proxy-09190287.js";import{A as y,i as g,c as u}from"./index-8fc13b8b.js";import{A as p}from"./index-b2a2f86f.js";const h=document.getElementById("nameInput"),f=document.getElementById("submitNameButton"),l=document.getElementById("nameStatus"),a=document.getElementById("mainPage"),i=document.getElementById("nameSection"),s=document.getElementById("principalDisplay"),w=document.getElementById("createOrgButton"),E=document.getElementById("viewOrgButton");let o,r;const k=async()=>{const e=new d;await e.fetchRootKey(),o=y.createActor(g,{agent:e,canisterId:u})},B=async()=>{var n;r=(n=(await p.create()).getIdentity().getPrincipal())==null?void 0:n.toText(),r?s.textContent=`Your Principal: ${r}`:alert("Failed to retrieve principal. Please log in again.")},I=async()=>{try{if(!r)throw new Error("User principal is not defined.");const e=m.fromText(r),t=await o.getUserByPrincipal(e);if(console.log("Retrieved users:",t),Array.isArray(t)&&t.length>0){const n=t[0];n&&n.name?(i.style.display="none",a.style.display="block",s.textContent=`Welcome back, ${n.name}!`):(console.warn("User or user.name is invalid:",n),i.style.display="block",a.style.display="none")}else console.warn("No users found for the given principal:",r),i.style.display="block",a.style.display="none"}catch(e){console.error("Error checking user name:",e),alert("An error occurred while checking the user name. Please try again.")}},A=async()=>{try{if(!r)throw new Error("User principal is not defined.");const e=await o.getMyOrganizations();console.log("User organizations:",e);const t=document.createElement("ul");if(t.id="orgList",a.appendChild(t),t.innerHTML="",Array.isArray(e)&&e.length>0)e.forEach(n=>{const c=document.createElement("li");c.textContent=n.name,t.appendChild(c)});else{const n=document.createElement("p");n.textContent="You are not part of any organizations.",t.appendChild(n)}}catch(e){console.error("Error fetching user organizations:",e),alert("An error occurred while fetching your organizations. Please try again.")}};B().then(()=>{I().then(()=>{a.style.display==="block"&&A()})});f.addEventListener("click",async()=>{const e=h.value.trim();if(!e){alert("Please enter a valid name.");return}try{if(await o.createUser(e))l.style.display="block",l.textContent="Name assigned successfully!",i.style.display="none",a.style.display="block",s.textContent=`Welcome, ${e}!`;else throw new Error("Failed to save name in the backend.")}catch(t){console.error("Error assigning name:",t),alert("An error occurred while assigning your name. Please try again.")}});w.addEventListener("click",async()=>{const e=prompt("Enter the name of the organization:");if(!e){alert("Organization name cannot be empty.");return}const t=await o.createOrganization(e);alert(`Organization created with ID: ${t}`)});E.addEventListener("click",()=>{window.location.href="./organizations.html"});k();
