import{P as l,H as p}from"./proxy-09190287.js";import{A as y,i as u,c as h}from"./index-0c47c2a4.js";import{A as f}from"./index-b2a2f86f.js";const w=document.getElementById("nameInput"),E=document.getElementById("submitNameButton"),g=document.getElementById("nameStatus"),c=document.getElementById("mainPage"),m=document.getElementById("nameSection"),s=document.getElementById("principalDisplay"),I=document.getElementById("createOrgButton"),B=document.getElementById("viewOrgButton");let o,r;const O=async()=>{const e=new p;await e.fetchRootKey(),o=y.createActor(u,{agent:e,canisterId:h})},b=async()=>{var n;r=(n=(await f.create()).getIdentity().getPrincipal())==null?void 0:n.toText(),r?s.textContent=`Your Principal: ${r}`:alert("Failed to retrieve principal. Please log in again.")},k=async()=>{try{if(!r)throw new Error("User principal is not defined.");const e=l.fromText(r),t=await o.getUserByPrincipal(e);if(t){const i=t[0];if(i&&i.name){m.style.display="none",c.style.display="block",s.textContent=`Welcome back, ${i.name}!`;return}}const n=prompt("It seems you don't have a name set. Please enter your name:");if(!n){alert("Name is required to proceed.");return}const a=await o.createUserForTesting(n,e);if(a&&a.name)m.style.display="none",c.style.display="block",s.textContent=`Welcome, ${a.name}!`;else throw new Error("Failed to create a new user.")}catch(e){console.error("Error checking user name:",e),alert("An error occurred while checking the user name. Please try again.")}},P=async()=>{try{if(!r)throw new Error("User principal is not defined.");const e=l.fromText(r);console.log("Sending principal to backend:",r);const t=await o.getMyOrganizations(e);if(console.log("Raw response from getMyOrganizations:",t),!Array.isArray(t))throw new Error("Invalid response format from getMyOrganizations.");const n=document.getElementById("orgList")||document.createElement("ul");if(n.id="orgList",n.innerHTML="",c.appendChild(n),t.length>0)t.forEach(a=>{const i=a.name,d=document.createElement("li");d.textContent=i,n.appendChild(d)});else{const a=document.createElement("p");a.textContent="You are not part of any organizations.",n.appendChild(a)}}catch(e){console.error("Error fetching user organizations:",e),alert("An error occurred while fetching your organizations. Please try again.")}};b().then(()=>{k().then(()=>{c.style.display==="block"&&P()})});E.addEventListener("click",async()=>{const e=w.value.trim();if(!e){alert("Please enter a valid name.");return}try{const t=l.fromText(r);if(await o.createUserForTesting(e,t))g.style.display="block",g.textContent="Name assigned successfully!",m.style.display="none",c.style.display="block",s.textContent=`Welcome, ${e}!`;else throw new Error("Failed to save name in the backend.")}catch(t){console.error("Error assigning name:",t),alert("An error occurred while assigning your name. Please try again.")}});I.addEventListener("click",async()=>{const e=prompt("Enter the name of the organization:");if(!e){alert("Organization name cannot be empty.");return}try{const t=l.fromText(r),n=await o.createOrganization(t,e);alert(`Organization created with ID: ${n}`)}catch(t){console.error("Error creating organization:",t),alert("An error occurred while creating the organization. Please try again.")}});B.addEventListener("click",()=>{window.location.href="./organizations.html"});O();
